{"version":3,"file":"index.js","sources":["../src/getCheckDigit.js","../src/index.js"],"sourcesContent":["const VALUES_MAP = {\n  '0': 0,\n  '1': 1,\n  '2': 2,\n  '3': 3,\n  '4': 4,\n  '5': 5,\n  '6': 6,\n  '7': 7,\n  '8': 8,\n  '9': 9,\n  'A': 10,\n  'B': 11,\n  'C': 12,\n  'D': 13,\n  'E': 14,\n  'F': 15,\n  'G': 16,\n  'H': 17,\n  'I': 18,\n  'J': 19,\n  'K': 20,\n  'L': 21,\n  'M': 22,\n  'N': 23,\n  '&': 24,\n  'O': 25,\n  'P': 26,\n  'Q': 27,\n  'R': 28,\n  'S': 29,\n  'T': 30,\n  'U': 31,\n  'V': 32,\n  'W': 33,\n  'X': 34,\n  'Y': 35,\n  'Z': 36,\n  ' ': 37,\n  'Ñ': 38\n};\n\nconst getScore = (string) => string.split('').reverse().reduce((sum, char, i) => {\n  const index = i + 2;\n  const value = VALUES_MAP[char] || 0;\n  return sum + value * index;\n}, 0);\n\nmodule.exports = (input) => {\n  const rfc = input.length === 12 ? ` ${input}` : input;\n  const base = rfc.slice(0, -1);\n  const score = getScore(base);\n  const mod = (11000 - score) % 11;\n  if (mod === 11) return '0';\n  if (mod === 10) return 'A';\n  return String(mod);\n};\n","const getCheckDigit = require('./getCheckDigit');\nconst forbiddenWords = require('./forbiddenWords.json');\nconst validRfcs = require('./validRfcs.json');\n\nconst RFC_REGEXP = /^([A-ZÑ\\x26]{3,4})([0-9]{6})([A-Z0-9]{3})$/;\nconst INVALID_FORMAT_ERROR = 'INVALID_FORMAT';\nconst INVALID_DATE_ERROR = 'INVALID_DATE';\nconst INVALID_VERIFICATION_DIGIT_ERROR = 'INVALID_VERIFICATION_DIGIT';\nconst FORBIDDEN_WORD_ERROR = 'FORBIDDEN_WORD';\nconst RFC_TYPE_FOR_LENGTH = {\n  '12': 'company',\n  '13': 'person'\n};\nconst SPECIAL_CASES = {\n  'XEXX010101000': 'foreign',\n  'XAXX010101000': 'generic'\n};\n\nconst parseInput = (input) => {\n  return String(input)\n    .trim()\n    .toUpperCase()\n    .replace(/[^0-9A-ZÑ\\x26]/g, '');\n};\n\nconst validateDate = (rfc) => {\n  const dateStr = rfc.slice(0, -3).slice(-6);\n  const year = dateStr.slice(0, 2);\n  const month = dateStr.slice(2, 4);\n  const day = dateStr.slice(4, 6);\n  const date = new Date(`20${year}-${month}-${day}`);\n  return !isNaN(date.getTime());\n};\n\nconst validateVerificationDigit = (rfc) => {\n  const digit = rfc.slice(-1);\n  const expected = getCheckDigit(rfc);\n  return expected === digit;\n};\n\nconst hasForbiddenWords = (rfc) => {\n  const prefix = (rfc || '').slice(0, 4);\n  return forbiddenWords.includes(prefix);\n};\n\nconst validate = (rfc, { omitVerificationDigit } = {}) => {\n  if (isSpecialCase(rfc) || isValidCase(rfc)) return [];\n  const errors = [];\n  const hasValidFormat = RFC_REGEXP.test(rfc);\n  const hasValidDate = hasValidFormat ? validateDate(rfc) : true;\n  const hasValidDigit = hasValidFormat ? validateVerificationDigit(rfc) : true;\n  if (!hasValidFormat) errors.push(INVALID_FORMAT_ERROR);\n  if (!hasValidDate) errors.push(INVALID_DATE_ERROR);\n  if (!hasValidDigit && !omitVerificationDigit) errors.push(INVALID_VERIFICATION_DIGIT_ERROR);\n  if (hasForbiddenWords(rfc)) errors.push(FORBIDDEN_WORD_ERROR);\n  return errors;\n};\n\nconst isSpecialCase = (rfc) => rfc in SPECIAL_CASES;\n\nconst isValidCase = (rfc) => validRfcs.includes(rfc);\n\nconst getType = (rfc) => SPECIAL_CASES[rfc] || RFC_TYPE_FOR_LENGTH[rfc.length] || null;\n\nconst getValidResponse = (rfc) => ({\n  isValid: true,\n  rfc,\n  type: getType(rfc)\n});\n\nconst getInvalidResponse = (errors) => ({\n  isValid: false,\n  rfc: null,\n  type: null,\n  errors\n});\n\nmodule.exports = (input, options) => {\n  const rfc = parseInput(input);\n  const errors = validate(rfc, options);\n  const isValid = errors.length === 0;\n\n  return isValid ? getValidResponse(rfc) : getInvalidResponse(errors);\n};\n"],"names":["VALUES_MAP","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","getCheckDigit","input","base","length","concat","slice","mod","split","reverse","reduce","sum","char","i","String","forbiddenWords","validRfcs","RFC_REGEXP","INVALID_FORMAT_ERROR","INVALID_DATE_ERROR","INVALID_VERIFICATION_DIGIT_ERROR","FORBIDDEN_WORD_ERROR","RFC_TYPE_FOR_LENGTH","SPECIAL_CASES","XEXX010101000","XAXX010101000","validateDate","rfc","dateStr","year","month","day","date","Date","isNaN","getTime","validateVerificationDigit","digit","hasForbiddenWords","prefix","includes","isSpecialCase","isValidCase","getType","options","trim","toUpperCase","replace","parseInput","errors","omitVerificationDigit","arguments","undefined","hasValidFormat","test","hasValidDate","hasValidDigit","push","validate","isValid","type","getValidResponse","getInvalidResponse"],"mappings":"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"}